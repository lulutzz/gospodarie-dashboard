<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Dashboard GospodƒÉrie ‚Äì PRO</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        background: #111;
        color: #fff;
        font-family: Arial;
        padding: 20px;
    }

    .title {
        text-align: center;
        font-size: 28px;
        margin-bottom: 25px;
        font-weight: bold;
        color: #ffcc66;
    }

    .cards {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
        margin-bottom: 40px;
    }

    .card {
        background: #1a1a1a;
        padding: 20px;
        border-radius: 12px;
        width: 260px;
        text-align: center;
        transition: 0.3s ease;
        box-shadow: 0 0 20px #000;
    }

    .label {
        font-size: 18px;
        opacity: 0.7;
    }

    .value {
        font-size: 46px;
        font-weight: bold;
        margin-top: 10px;
    }

    /* Anima»õie puls */
    .pulse {
        animation: pulseAnim 0.5s ease-in-out;
    }

    @keyframes pulseAnim {
        0% { transform: scale(1); }
        50% { transform: scale(1.06); }
        100% { transform: scale(1); }
    }

    /* ALERTA */
    .alert {
        border: 2px solid red;
        box-shadow: 0 0 10px red;
    }

    #charts-container {
        max-width: 1000px;
        margin: auto;
    }

    canvas {
        margin-top: 40px;
    }
</style>
</head>

<body>

<div class="title">üå°Ô∏è Dashboard GospodƒÉrie ‚Äì TemperaturƒÉ & UmezealƒÉ (PRO)</div>

<div class="cards">
    <div class="card" id="tempCard">
        <div class="label">TemperaturƒÉ</div>
        <div class="value" id="tempValue">-- ¬∞C</div>
    </div>

    <div class="card" id="humCard">
        <div class="label">UmezealƒÉ</div>
        <div class="value" id="humValue">-- %</div>
    </div>
</div>

<div id="charts-container">
    <canvas id="chartLive"></canvas>
    <canvas id="chart7"></canvas>
    <canvas id="chart30"></canvas>
</div>

<script>
const CHANNEL_ID = 1613849;  // ‚Üê pune ID-ul tƒÉu
const API_KEY = "ZPT57WZJNMLGM2X1"; // ‚Üê pune READ API KEY

//------------------------------------------------
// UPDATE VALORI LIVE + ANIMA»öIE + ALERTE
//------------------------------------------------
function updateCards() {
    fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${API_KEY}&results=1`)
        .then(r => r.json())
        .then(data => {

            let feed = data.feeds[0];
            let temp = Number(feed.field1);
            let hum  = Number(feed.field2);

            let tempCard = document.getElementById("tempCard");
            let humCard  = document.getElementById("humCard");

            // Actualizare valori
            document.getElementById("tempValue").innerHTML = temp + "¬∞C";
            document.getElementById("humValue").innerHTML  = hum + "%";

            // Anima»õie puls
            tempCard.classList.add("pulse");
            humCard.classList.add("pulse");
            setTimeout(() => {
                tempCard.classList.remove("pulse");
                humCard.classList.remove("pulse");
            }, 400);

            //----------------------
            // SISTEM ALERTƒÇ
            //----------------------

            // ALERTƒÇ TEMPERATURƒÇ
            if (temp >= 35) {
                tempCard.classList.add("alert");
            } else {
                tempCard.classList.remove("alert");
            }

            // ALERTƒÇ UMIDITATE
            if (hum <= 30) {
                humCard.classList.add("alert");
            } else {
                humCard.classList.remove("alert");
            }
        });
}

//------------------------------------------------
// GRAFIC LIVE (ultimele 50 valori)
//------------------------------------------------
function loadLiveChart() {
    fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${API_KEY}&results=50`)
        .then(r => r.json())
        .then(data => {

            let labels = data.feeds.map(x => x.created_at.substring(11, 19));
            let T = data.feeds.map(x => Number(x.field1));
            let H = data.feeds.map(x => Number(x.field2));

            new Chart(document.getElementById("chartLive"), {
                type: "line",
                data: {
                    labels: labels,
                    datasets: [
                        { label: "TemperaturƒÉ (¬∞C)", data: T, borderColor: "red", tension: 0.3 },
                        { label: "UmezealƒÉ (%)", data: H, borderColor: "cyan", tension: 0.3 }
                    ]
                },
                options: { scales: { x: { ticks: { color: "#fff" } }, y: { ticks: { color: "#fff" } } } }
            });
        });
}

//------------------------------------------------
// GRAFIC 7 ZILE
//------------------------------------------------
function load7DayChart() {
    fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${API_KEY}&days=7`)
        .then(r => r.json())
        .then(data => {

            let labels = data.feeds.map(x => x.created_at.substring(0, 10));
            let T = data.feeds.map(x => Number(x.field1));

            new Chart(document.getElementById("chart7"), {
                type: "line",
                data: {
                    labels: labels,
                    datasets: [
                        { label: "TemperaturƒÉ 7 zile", data: T, borderColor: "orange", tension: 0.2 }
                    ]
                },
                options: { scales: { x: { ticks: { color: "#fff" } }, y: { ticks: { color: "#fff" } } } }
            });
        });
}

//------------------------------------------------
// GRAFIC 30 ZILE
//------------------------------------------------
function load30DayChart() {
    fetch(`https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${API_KEY}&days=30`)
        .then(r => r.json())
        .then(data => {

            let labels = data.feeds.map(x => x.created_at.substring(0, 10));
            let T = data.feeds.map(x => Number(x.field1));

            new Chart(document.getElementById("chart30"), {
                type: "line",
                data: {
                    labels: labels,
                    datasets: [
                        { label: "TemperaturƒÉ 30 zile", data: T, borderColor: "yellow", tension: 0.2 }
                    ]
                },
                options: { scales: { x: { ticks: { color: "#fff" } }, y: { ticks: { color: "#fff" } } } }
            });
        });
}

//------------------------------------------------
// PORNIRE
//------------------------------------------------
updateCards();
loadLiveChart();
load7DayChart();
load30DayChart();

// Refresh valori la 15 secunde
setInterval(updateCards, 15000);
//------------------------------------------------
// REFRESH AUTOMAT GRAFICE
//------------------------------------------------

// Refresh grafic LIVE la fiecare 15 secunde
setInterval(() => {
    // »òtergem graficul vechi
    document.getElementById("chartLive").remove();
    let canvas = document.createElement("canvas");
    canvas.id = "chartLive";
    document.getElementById("charts-container").prepend(canvas);

    loadLiveChart();
}, 15000);

// Refresh grafice 7 zile / 30 zile la fiecare 5 minute
setInterval(() => {

    // 7 zile
    document.getElementById("chart7").remove();
    let c7 = document.createElement("canvas");
    c7.id = "chart7";
    document.getElementById("charts-container").append(c7);

    // 30 zile
    document.getElementById("chart30").remove();
    let c30 = document.createElement("canvas");
    c30.id = "chart30";
    document.getElementById("charts-container").append(c30);

    load7DayChart();
    load30DayChart();

}, 5 * 60 * 1000); // 5 minute

</script>

</body>
</html>
